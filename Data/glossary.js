// Термины
const glossaryTerms = [
    { title: "Formula 1",
        text: "Чемпионат мира по кольцевым автогонкам.",
        fullText: "Формула 1 – это чемпионат мира по кольцевым автогонкам, который разыгрывается ежегодно и состоит из этапов – Гран-при. По итогам каждого сезона определяются победители в личном и командном зачетах. Гонщику, занявшему первое место в личном зачете, присваивается титул чемпиона мира, а команде – Кубок конструкторов.",
        tag: "Основы", tagColor: "#F50123"},
	{ title: "Гран-при",
        text: "Этап чемпионата мира, который проходит на различных трассах по всему миру.",
        fullText: "Гран-при — это этап чемпионата мира, который проходит на различных трассах по всему миру. Этап Гран-при является ключевым событием в календаре гонок и привлекает внимание миллионов зрителей. Победа на Гран-при считается одной из самых престижных в карьере гонщика.",
        tag: "Основы", tagColor: "#F50123"},
	{ title: "Квалификация",
        text: "Предгоночная сессия, в которой пилоты пытаются показать лучший круг.",
        fullText: "Квалификация — это часовая сессия, в которой пилоты пытаются показать лучший круг. Пилоты стартуют в гонке в соответствии с результатами, показанными в квалификации. В Формуле-1 победа в квалификации не приносит дополнительных очков.",
        tag: "Основы", tagColor: "#F50123"},
	{ title: "Поул-позиция",
        text: "Самая привилегированная позиция на старте гонки.",
        fullText: "Поул-позиция — это самая привилегированная позиция на старте гонки, которая определяется на основе результатов квалификационных заездов. С этой позиции выходит первый гонщик на стартовой решетке.",
        tag: "Основы", tagColor: "#F50123"},
	{ title: "Прогревочный круг",
        text: "Дополнительный круг, который пилоты проходят перед стартом гонки.",
        fullText: "Прогревочный круг — это дополнительный круг, который пилоты проходят перед стартом гонки с целью прогрева шин и подготовки к гонке. Этот круг помогает улучшить сцепление шин с дорогой и увеличить эффективность торможения и управления автомобилем в первых поворотах гонки.",
        tag: "Основы", tagColor: "#F50123"},
		
	{ title: "Болид",
        text: "Специализированный гоночный автомобиль, разработанный и сконструированный для участия в гонках.",
        fullText: "Болид — это специализированный гоночный автомобиль, разработанный и сконструированный для участия в гонках. Он обладает высокой степенью аэродинамической эффективности, мощным двигателем и легким каркасом, чтобы обеспечить максимальную скорость и маневренность на трассе.",
        tag: "Болид", tagColor: "#0bbd32"},		
    { title: "Кокпит",
        text: "Кабина пилота в болиде.",
        fullText: "Кокпит — это кабина пилота. Она представляет собой компромисс между безопасностью и комфортом. Для пилота важно, чтобы он чувствовал себя максимально комфортно, учитывая тесное пространство и длительное время, проведенное в нем.",
        tag: "Болид", tagColor: "#0bbd32"},		
    { title: "Обтекатель",
        text: "Элемент автомобиля Формулы-1, который отвечает за создание оптимальной аэродинамики.",
        fullText: "Обтекатель — это ключевой элемент автомобиля, который отвечает за создание оптимальной аэродинамики. Обеспечивая более гладкое движение по воздушному потоку, повышает управляемость машины на трассе.",
        tag: "Болид", tagColor: "#0bbd32"},
	{ title: "Активная подвеска",
        text: "Комплекс программно-аппаратных средств, управляющих клиренсом автомобиля.",
        fullText: "Активная подвеска - это комплекс программно-аппаратных средств, управляющих клиренсом автомобиля во время движения с помощью гидравлических приводов, встроенных в подвеску. Это позволяет улучшить управляемость (реакция на руль становится менее зависимой от неровностей дороги), повысить безопасность и увеличить прижимную силу.",
        tag: "Болид", tagColor: "#0bbd32"},
	{ title: "Антикрыло",
        text: "Элемент аэродинамики гоночного болида.",
        fullText: "Антикрыло — это элемент аэродинамики гоночного болида, который, в отличие от крыльев самолета, создает не подъемную, а прижимную силу. Позволяет болиду проходить повороты с большей скоростью за счет увеличения прижимной силы, но замедляет на прямых участках трассы.",
		tags: [
            { name: "Болид", color: "#0bbd32"},
            { name: "Аэродинамика", color: "#7f6df7"}]},
	{ title: "DRS",
        text: "Система снижения лобового сопротивления.",
        fullText: "Drag Reduction System - система снижения лобового сопротивления, которая позволяет гонщику увеличить скорость на прямых участках трассы. DRS может быть активирована только в определенных зонах и при выполнении определенных условий, например, когда гонщик находится менее чем в одной секунде позади другого автомобиля.",
        tag: "Болид", tagColor: "#0bbd32"},
		
	{ title: "Шпилька",
        text: "Поворот на 180 градусов.",
        fullText: "Шпилька — это поворот на 180 градусов, часто встречающийся на гоночных трассах. Этот элемент требует от гонщиков высокой точности и контроля, так как необходимо резко снизить скорость и плавно войти в поворот.",
        tag: "Трасса", tagColor: "#77997f"},
	{ title: "Шикана",
        text: "Сложная последовательность поворотов.",
        fullText: "Шикана — это сложная последовательность поворотов, предназначенная для замедления болидов на трассе. Обычно шикана состоит из двух или более быстрых поворотов в противоположные стороны, что требует от гонщиков высокой техники и точности.",
        tag: "Трасса", tagColor: "#77997f"},
    { title: "Керб ",
        text: "Возвышение по краям трассы, которое служит границей для гонщиков.",
        fullText: "Kerb - это возвышение по краям трассы, которое служит границей для гонщиков. Переезжать через керб иногда полезно для сокращения времени прохождения круга, но это также может быть опасным, так как машина может потерять сцепление с дорогой.",
        tag: "Трасса", tagColor: "#77997f"},	
	{ title: "Апекс",
        text: "Ближайшая точка на трассе к внутренней кромке поворота.",
        fullText: "Апекс — это ближайшая точка на трассе к внутренней кромке поворота, в которой гонщик находится во время прохождения поворота. Гонщики ориентируются на эту точку для выполнения маневра. Существуют поздний (широкий вход) и ранний апекс (узкий вход), которые зависят от стиля вождения и характера виража.",
        tag: "Трасса", tagColor: "#77997f"},
	{ title: "Гравийная ловушка",
        text: "Участок за пределами трассы автодрома, покрытый гравием или другим материалом.",
        fullText: "Гравийная ловушка — это участок за пределами трассы автодрома, покрытый гравием или другим материалом, способствующим замедлению скорости автомобиля в случае выхода за пределы трассы. Гравий создает сопротивление движению болида и помогает предотвратить серьезные аварии за счет снижения скорости.",
        tags: [
            { name: "Трасса", color: "#77997f" },
            { name: "Безопасность", color: "#de8c09" }]},
	{ title: "Отбойник",
        text: "Защитное ограждение из стальной ленты, установленное на трассе.",
        fullText: "Отбойник — это защитное ограждение из стальной ленты, установленное на трассе. Предотвращает вылет болида за пределы трассы в случае аварии или выхода из контроля.",
        tags: [
            { name: "Трасса", color: "#77997f" },
            { name: "Безопасность", color: "#de8c09" }]},
	
	{ title: "Слипстрим",
        text: "Аэродинамический эффект, который возникает, когда один автомобиль движется непосредственно за другим.",
        fullText: "Slipstream - это aэродинамический эффект, который возникает, когда один автомобиль движется непосредственно за другим, находясь в зоне пониженного сопротивления воздуха. Это позволяет автомобилю позади развить более высокую скорость и совершить обгон.",
        tag: "Аэродинамика", tagColor: "#7f6df7"},	
	{ title: "Прижимная сила",
        text: "Aэродинамическое явление, при котором болид прижимается к трассе.",
        fullText: "Прижимная сила — это аэродинамическое явление, при котором болид прижимается к трассе под воздействием воздушного потока. При высоких скоростях аэродинамическая конструкция болида напоминает перевернутое крыло самолета, создавая эффект прижатия с силой до 4G.",
        tag: "Аэродинамика", tagColor: "#7f6df7"},
		
    { title: "Пит-лэйн",
        text: "Специальная часть трассы, по которой болиды подъезжают к своим боксам.",
        fullText: "Пит-лэйн — это специальная часть трассы, по которой болиды подъезжают к своим боксам для проведения пит-стопов. На этом участке трассы установлено ограничение скорости, обычно 80 км/ч, и нарушение этого правила карается штрафом.",
        tags: [
            { name: "Пит-лэйн", color: "#e1f507" },
			{ name: "Пит-стоп", color: "#332ab5"},
            { name: "Трасса", color: "#77997f" }]},
    { title: "Бокс/Паддок",
        text: "Гараж, принадлежащий команде, который расположен на пит-лейне.",
        fullText: "Бокс или паддок — это гараж, принадлежащий команде, который расположен на пит-лейне и используется для хранения всего оборудования и инструментов команды во время гонки. Именно сюда болиды заезжают на пит-стоп.",
        tags: [
            { name: "Пит-лэйн", color: "#e1f507"},
            { name: "Пит-стоп", color: "#332ab5"}]},
    { title: "Закрытый парк",
        text: "Помещение, где содержатся все болиды после завершения третьей квалификационной сессии и до начала гонки.",
        fullText: "Закрытый парк — это помещение, где содержатся все болиды после завершения третьей квалификационной сессии и до начала гонки. В этом месте команды не имеют права проводить работы над машинами, кроме как по разрешению стюардов.",
        tag: "Пит-лэйн", tagColor: "#e1f507"},
	
	{ title: "Пит-стоп",
        text: "Остановка гонщика в боксах для замены шин.",
        fullText: "Пит-стоп — это остановка гонщика в боксах для замены шин. Правильное планирование и исполнение пит-стопов играет ключевую роль в успехе гонки, так как позволяет экономить время и поддерживать оптимальную производительность болида на трассе.",
        tag: "Пит-стоп", tagColor: "#332ab5"},
    { title: "Алебарда",
        text: "Длинный шест, который механик держит перед гонщиком во время пит-стопа.",
        fullText: "Алебарда — это длинный шест, который механик держит перед гонщиком во время пит-стопа, на одной стороне которого написано “STOP”, а на другой стороне “1-я передача”. Этот инструмент используется для указания гонщику остановиться или выбрать первую передачу.",
        tag: "Пит-стоп", tagColor: "#332ab5"},
		  
	{ title: "Андеркат",
        text: "Стратегия, при которой гонщик заезжает на пит-стоп раньше своего соперника.",
        fullText: "Undercut - стратегия, при которой гонщик заезжает на пит-стоп раньше своего соперника, чтобы воспользоваться свежими шинами и быстрее проехать следующий круг. Если соперник заезжает на пит-стоп позже, гонщик с андеркатом может обогнать его за счет более высокого темпа на свежих шинах.",
        tag: "Стратегия", tagColor: "#ba0690"},
    { title: "Оверкат",
        text: "Стратегия являющаяся противоположностью андерката. ",
        fullText: "Overcut - стратегия, являющаяся противоположностью андерката. Гонщик, находящийся позади, остается на трассе дольше, чтобы извлечь выгоду из улучшенных условий или проблем соперника на пит-стопе. Оверкат может сработать, если темп гонщика на изношенных шинах остается достаточно высоким, чтобы компенсировать потерянное время на пит-стопе.",
        tag: "Стратегия", tagColor: "#ba0690"},
	
    { title: "Шины",
        text: "Soft, Medium, Hart, Intermediate, Wet.",
        fullText: "На каждом отдельно взятом Гран-при разрешено использовать до 5 типов резины – промежуточный и дождевой типы доступны на всех Гран-при, но к ним добавляются три из шести сухих типов, которые Pirelli выбирает заранее. Все типы шин, включая дождевые, имеют собственную цветовую маркировку. Промежуточный (Intermediate) помечается зеленым цветом, а дождевой (Wet) – синим. Самый мягкий (Soft) из этих трех типов резины помечается красным цветом, средний (Medium) — желтым, а самый жесткий (Hard) получает белую маркировку.",
        tag: "Шины", tagColor: "#c9c1c7"},
	{ title: "Слики",
        text: "Шины с гладкой и липкой поверхностью.",
        fullText: "Слики — это шины с гладкой и липкой поверхностью, предназначенные для использования на сухих трассах. Они обеспечивают максимальное сцепление колес с дорогой благодаря отсутствию протектора.",
        tag: "Шины", tagColor: "#c9c1c7"},
	{ title: "Грипп",
        text: "Степень сцепления шин с дорожным покрытием.",
        fullText: "Grip - степень сцепления шин с дорожным покрытием. Чем выше грипп, тем лучше машина держится на трассе, что важно для высоких скоростей в поворотах.",
        tag: "Шины", tagColor: "#c9c1c7"},	
	
    { title: "Пейс-кар",
        text: "Автомобиль, который выходит на трассу, когда возникает опасная ситуация.",
        fullText: "Safety Car - автомобиль, который выходит на трассу, когда возникает опасная ситуация, требующая замедления гонки. Пейс-кар ограничивает скорость всех машин на трассе до тех пор, пока проблема не будет устранена.",
        tag: "Безопасность", tagColor: "#de8c09"},

    { title: "Флаги",
        text: "Сигнальные знаки, которые используются на трассе.",
        fullText: "Флаги — это сигнальные знаки, которые используются на трассе для информирования гонщиков о различных ситуациях. Они помогают пилотам правильно реагировать на происходящее на трассе, обеспечивая безопасность и соблюдение правил.",
        tag: "Флаги", tagColor: "#025257"},
    { title: "Зеленый флаг",
        text: "Сигнал о том, что трасса свободна.",
        fullText: "Зеленый флаг — это сигнал о том, что трасса свободна, и гонка или тренировка могут продолжаться. Он часто показывается перед стартом гонки, подтверждая, что нет препятствий на пути. Этот флаг означает, что все условия безопасны для продолжения движения.",
        tag: "Флаги", tagColor: "#025257"},
    { title: "Красный флаг",
        text: "Сигнал к немедленной остановке гонки.",
        fullText: "Красный флаг — это сигнал к немедленной остановке гонки или тренировки из-за опасных условий на трассе. Пилоты обязаны вернуться на стартовую позицию или в боксы, как только видят этот флаг. Причиной его появления могут быть аварии, плохие погодные условия или другие угрозы безопасности.",
        tags: [
            { name: "Флаги", color: "#025257" },
            { name: "Безопасность", color: "#de8c09" }]},
    { title: "Синий флаг",
        text: "Предупреждение пилотам, что к ним приближается более быстрая машина.",
        fullText: "Синий флаг — это предупреждение пилотам, что к ним приближается более быстрая машина, которая опережает их на круг. Это сигнал для медленных гонщиков уступить дорогу и дать возможность лидеру обогнать.",
        tag: "Флаги", tagColor: "#025257"},	
    { title: "Белый флаг",
        text: "Предупреждающий о том, что болид, находящийся впереди, движется с чрезмерно медленной скоростью.",
        fullText: "Белый флаг — это сигнал для гонщика, предупреждающий о том, что болид, находящийся впереди, движется с чрезмерно медленной скоростью. Водителю необходимо проявить осторожность, чтобы избежать столкновения с медленным транспортом.",
        tag: "Флаги", tagColor: "#025257"},	
    { title: "Желтый флаг",
        text: "Предупреждение об опасности на трассе.",
        fullText: "Желтый флаг — это предупреждение об опасности на трассе, запрещающее обгоны и требующее снизить скорость. Гонщики обязаны быть готовыми к возможным препятствиям или аварийным ситуациям впереди.",
        tags: [
            { name: "Флаги", color: "#025257" },
            { name: "Безопасность", color: "#de8c09" }]},
    { title: "Полосатый желто-красный флаг",
        text: "Сигнал, указывающий на то, что на трассе присутствуют скользкие участки.",
        fullText: "Полосатый желто-красный флаг — это сигнал, указывающий на то, что на трассе присутствуют скользкие участки из-за разлива масла или начавшегося дождя. Гонщики должны быть особенно внимательны и снизить скорость, чтобы избежать вылета с трассы.",
        tags: [
            { name: "Флаги", color: "#025257" },
            { name: "Безопасность", color: "#de8c09" }]},
    { title: "Черный флаг",
        text: "Приказ гонщику немедленно заехать в боксы.",
        fullText: "Черный флаг — это приказ гонщику немедленно заехать в боксы, остановить болид и выйти из него, сопровождаемый указанием стартового номера. Несоблюдение этого указания может привести к серьезным санкциям и штрафам.",
        tag: "Флаги", tagColor: "#025257"},
    { title: "Клетчатый флаг",
        text: "Сигнал о завершении гонки.",
        fullText: "Клетчатый флаг — это сигнал о завершении гонки. Он используется для обозначения финиша и означает, что все участники должны прекратить гонку и вернуться в боксы. Этот флаг поднимается, когда первый гонщик пересекает финишную линию, завершая соревнование.",
        tag: "Флаги", tagColor: "#025257"},
];

// Рендеринг страницы
function renderGlossary(terms) {
    const content = document.getElementById('content');
    
    // Структура глоссария
    content.innerHTML = `
        <div class="glossary">
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Поиск">
            </div>
            <div class="tags-filter" id="tagsFilter"></div>
            <div class="terms-grid" id="termsGrid"></div>
        </div>
    `;

    const searchInput = document.getElementById('searchInput');
    const tagsFilter = document.getElementById('tagsFilter');
    const termsGrid = document.getElementById('termsGrid');

    // Собировка терминов по тегам
    const allTags = ["Все"]; // Добавляем опцию "Все" по умолчанию
    
    terms.forEach(term => {
        if (Array.isArray(term.tags)) {
            // Обработка нового формата с массивом тегов
            term.tags.forEach(tag => {
                if (!allTags.includes(tag.name)) allTags.push(tag.name);
            });
        } else if (term.tag && !allTags.includes(term.tag)) {
            // Обработка старого формата с одним тегом
            allTags.push(term.tag);
        }
    });

    // Теги
    tagsFilter.innerHTML = allTags.map(tag => `
        <button class="tag" data-tag="${tag === 'Все' ? '' : tag}">${tag}</button>
    `).join('');

    // Обработчик для фильтрации по тегам
    document.querySelectorAll('.tag').forEach(tagBtn => {
        tagBtn.addEventListener('click', () => {
            // Снимаем активность со всех кнопок
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
            
            // Активация тега
            tagBtn.classList.add('active');
            
            // Получение тега
            const selectedTag = tagBtn.getAttribute('data-tag');
            
            // Фильтруем термины по выбранному тегу
            const filteredTerms = selectedTag ? 
                terms.filter(term => 
                    (Array.isArray(term.tags) && term.tags.some(t => t.name === selectedTag)) || 
                    (!Array.isArray(term.tags) && term.tag === selectedTag)
                ) : 
                terms;
            
            // Обновляем сетку с отфильтрованными терминами
            updateTermsGrid(filteredTerms);
        });
    });

    updateTermsGrid(terms);

    // Обработчик поиска по заголовкам терминов
    searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const filteredTerms = terms.filter(term => 
            term.title.toLowerCase().includes(searchTerm)
        );
        updateTermsGrid(filteredTerms);
    });

    // Карточки терминов
    function updateTermsGrid(terms) {
        termsGrid.innerHTML = terms.map(term => {
            // Обработка как старого формата (один тег), так и нового (массив тегов)
            const tagsHtml = Array.isArray(term.tags) ? 
                term.tags.map(tag => 
                    `<span class="term-tag" style="background-color: ${tag.color}">${tag.name}</span>`
                ).join('') :
                `<span class="term-tag" style="background-color: ${term.tagColor}">${term.tag}</span>`;
            
            // Структура карточки термина
            return `
                <div class="term-card" data-title="${term.title}">
                    <h3>${term.title}</h3>
                    <div class="glos-divider"></div>
                    <p>${term.text}</p>
                    <div class="glos-divider"></div>
                    <div class="term-tags">${tagsHtml}</div>
                </div>
            `;
        }).join('');

        // Обработчик для открытия модальных окон
        document.querySelectorAll('.term-card').forEach(card => {
            card.addEventListener('click', () => {
                const termTitle = card.getAttribute('data-title');
                const term = terms.find(t => t.title === termTitle);
                openModal(term);
            });
        });
    }

    // Модальное окно
    function openModal(term) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        // Обработка тегов для модального окна
        const tagsHtml = Array.isArray(term.tags) ? 
            term.tags.map(tag => 
                `<span class="term-tag" style="background-color: ${tag.color}">${tag.name}</span>`
            ).join('') :
            `<span class="term-tag" style="background-color: ${term.tagColor}">${term.tag}</span>`;
        
        // Cтруктура модального окна
        modal.innerHTML = `
            <div class="modal-content-termin">
                <h3>${term.title}</h3>
                <div class="glos-divider"></div>
                <p>${term.fullText}</p>
                <div class="glos-divider"></div>
                <div class="term-tags">${tagsHtml}</div>
            </div>
        `;
        
        // Добавляем модальное окно в DOM
        document.body.appendChild(modal);

        // Обработчик закрытия модального окна по клику вне его
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });
    }
}

// Инициализация при загрузке вкладки
if (window.location.hash === '#glossary') {
    renderGlossary(glossaryTerms);
}
